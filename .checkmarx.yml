image: docker:latest
services:
  - docker:dind

.checkmarx_sast:
  stage: test
  image:
    name: docker.io/checkmarxts/cxflow:1.6.4
    entrypoint: ['']
  script:
    - cat ${CX_FLOW_CONFIG} > application.yml
    - java -jar /app/cx-flow.jar --spring.config.location=./application.yml 
        --scan 
        --cx-team="${CHECKMARX_TEAM}"
        --cx-project="${CI_PROJECT_NAME}-${CI_COMMIT_REF_NAME}" 
        --cx-flow.break-build=false
        --app="${CI_PROJECT_NAME}-${CI_COMMIT_REF_NAME}"
        --namespace="${CI_PROJECT_ROOT_NAMESPACE}"
        --repo="${CI_PROJECT_NAME}"
        --branch="${CI_COMMIT_REF_NAME}"
        --f=. 
  artifacts:
    reports:
      sast: gl-sast-report.json
    paths:
      - gl-sast-report.json

